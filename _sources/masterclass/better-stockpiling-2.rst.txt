.. _betterstockpiling02:
##################################################################
Foundations for Better Stockpiling II: The Five Primary Stockpiles
##################################################################

You read *Foundations for Better Stockpiling*. The written portion consists of
a 3 volume treatise entitled *Foundations for Better Stockpiling* authored by
*Mechanixm* in the year 2014. The first parts entitled :ref:`Intro to Quantum
Stockpiling <betterstockpiling01>`, concerns the explanation of basic quantum
stockpiles with minecarts. The second parts entitled :ref:`The Five Primary
Stockpiles <betterstockpiling02>` expands the technique into a method for
fortress-wide stockpiling.  The third parts entitled :ref:`Useful Custom
Stockpiles <betterstockpiling03>` exhibits advanced applications of the method.
The writing is full of illustrations yet very lengthy.


Original sources *Mechanixm's Guide to Better Stockpiling*:
:reddit:`Part 1 <2k0zb3>`, :reddit:`Part 2 <2kuvs1>`, :reddit:`Part 3
<2n9p3u>`.

Edited, updated, and expanded by Ramblurr in 2018.

.. contents::

:ref:`Part I <betterstockpiling01>` introduced the concept of Quantum
Stockpiles and Minecart Quantum Stockpiles. You should have a good
understanding of how to setup a heavy and light MQS. Refer back to Part I if
you forget any of the steps.

In Part II we will take those basic concepts and build a method for stockpiling
everything in the fortress.

Enter the Five Primary Stockpiles. These five stockpiles are are found in every
Fortress, and we use them as the backbone of an efficient and easy to
understand stockpiling system.

The theory behind these separate stockpiles is to have a single
source and destination for each step of the production chain. For each
production job, the source materials will come from one source and the product
will be placed in at one destination, maybe the same stockpile or maybe a
different one.

Using things system for your primary stockpiles will make the management of
your production flows easier to manage, expand, and importantly, understand.

.. tip::

  As you're building your own Fortress with this method in mind for the first
  time, it is beneficial to follow this guide exactly, or it won't fit the flow
  of your Fortress at all.

  Once you have a good grasp of the method, then use this guide as a framework
  to better customize the flow of items through your own fortress.


Introducing the Five Primary Stockpiles
=======================================

1. Materials
------------

Materials are items and objects, processed or otherwise, that will be used
alone or in conjunction with other items to produce a Finished Product.

Examples: Stones, Ore, Wood, Cloth, Thread, Bars, etc...

2. Finished Products
--------------------

Finished Products are items that have been created from Materials and *usually*
can't be used to create additional Finished Products.

A Finished Product serves a purpose outside of being a Material to create
something else.

Examples:
Furniture, Weapons, Armor, Blocks, Crafts, etc...

3. Refuse
---------

Refuse is the trash and byproducts generated by your Fortress that serve no
purpose besides taking up space and causing a stink.

Depending upon the needs and whims of your fortress Refuse could also include
Materials or Finished Goods with little to no trade value that you want to get
rid of.

Examples: Cartilage, Vermin Remains, Body Parts, Worn Out Clothing, Low Quality Finished Goods

4. Foodstuffs
-------------

Foodstuffs are both the Materials and Finished Products that are directly
related to creating Food and Booze items.

Theoretically, we could separate all of these out in to the Materials and
Finished Products Stockpiles, but in reality it's impractical. Our farms and
Food related workshops are usually not located near our other workshops, so it
makes sense to keep them separate.

But the most imprtant reason to separate Foodstuffs is that we will not be
putting Foodstuffs in quantum stockpiles. Barrels (which food items go inside)
behave in a buggy manner with quantum stockpiles.

5. Animals
----------

Animals are kept separate for the sake of convenience. They aren't actively
created by producing something in a Workshop. We usually have a place set aside
for where we keep Cage-Trapped enemies, and animals we've Cage-Trapped or
purchased from Caravans, and it's easiest to just keep them separate from the
Workshop Stockpiles.

Especially when it comes to Pitting caged enemies, it's best to easily glance
at your Animals Stockpile to see what you're dealing with.

Primary Stockpile, the Sixth
----------------------------

Depending on the location of your Forges and Smelters in relation to the rest
of your Workshops, it might be more efficient to create a Sixth Primary
Stockpile for your Ores, Stones, and Bars. However, in this guide there will be
no separate Metal Industry stockpile.

Examples: Metal Ore, Coal Producing Stone (Coal & Lignite), Flux Stone, Metal Bars, Coal Bars

Creating The Five
=================

Now that you know the basics of how to create MQSs and know what each of the
Five Primary stockpiles are for, we will move onto the creation of the
stockpiles themselves.

Below you will find the detailed item list for each stockpile. Only enable the
specific items listed, if it is not listed, then it should be disabled.

.. caution::  Remember! All barrels, bins should be set to 0 unless otherwise
  noted. Only Heavy Reciever stockpiles should have wheelbarrows.

1. Materials
------------

.. figure:: images/stockpile2-6.png

  A well established 1x15 Materials Primary stockpile being fed on both sides
  by a total of 10 Receivers. There are 6 Heavy Item Receivers and 4 Light Item
  Receivers. The QSP can be built on top of up/down stairs to provide quick and
  efficient access to the workshops.

- Food

  - Milled Plant -> Dyes
  - Fat -> Tallow (How to do this? Refer to :ref:`Fine Grained Item Selection section <betterstockpiling02select>`)
  - Extract -> Oils
  - Misc. Liquid -> Lye, lime

- Furniture/Siege Ammo

  - Type -> Sand Bags only
  - Enable all Stone/Clay, Metal, and Other Materials
  - Enable all Qualities except Artifact

- Refuse
  - Skulls
  - Bones
  - Shells
  - Teeth
  - Horns/Hooves

- Stone -> All Metal Ores, Economic, Other Stones, and Clay

  Note: As noted in the Sixth Primary Stockpile section above, if your metal
  industry is nowhere near your other workshops, feel free to exclude metal ores,
  flux stones, and coal producers.

- Bars/Blocks

  - Bars: Metal -> All
  - Bars: Other Materials -> everything but Soap

  Note: If your metal industry is nowhere near your other workshops, feel free to
  exclude all of these.


- Gems, Leather, Cloth, Wood -> Enable All

Don't forget to Name your Materials Stockpile :kbd:`q`, :kbd:`Ctrl` + :kbd:`Shift` + :kbd:`n`

2. Finished Products
--------------------

.. figure:: images/stockpile2-7.gif

  The Finished Products Stockpile (1x15) is fed by 5 Heavy Item Receiver (left)
  and 5 Light Item Receiver Stockpiles (right). You can see the right side is
  using larger 3x6 Receivers in order to accomodate a large influx of light
  items (in this gas, blocks for a mega construction).

- Animals -> Empty Cages Only
- Furniture

  - All Items Except Sand Bags
  - All Materials
  - All Qualities

- Ammo

  - All Types
  - All Materials
  - All Qualities

- Bars/Blocks

  - Blocks: All Materials

  Note: If your Metal Industry is closer to your Finished Goods Stockpile than
  your Materials Stockpile, then feel free to put all of your Metal Industry Bars
  and Materials here. Or, keep it separately by your Metal Industry.

- Finished Goods

  - All Types
  - All Materials
  - All Qualities

- Weapons/Trap Components

  - All Types
  - All Materials
  - All Qualities

- Armor

  - All Types
  - All Materials
  - All Qualities

.. figure:: images/stockpile2-2.gif

  Don't forget to Name your Finished Goods Stockpile :kbd:`q`, :kbd:`Ctrl` + :kbd:`Shift` + :kbd:`n`

3. Refuse
---------

.. figure:: images/stockpile2-3.png

  The refuse stockpile can be placed outside on the surface if it is safe
  behind walls.


- Light Refuse Stockpile Receiver Settings:

  - Refuse -> Item Types -> All
  - Refuse -> Body Parts -> All
  - Refuse -> Hair/Wool -> All

- Heavy Refuse Stockpile Receiver Settings:

  - Corpses -> Enable All
  - Refuse -> Corpses -> All

- Refuse Quantum Stockpile Settings:

  - Corpses -> All
  - Refuse -> Item Types -> All
  - Refuse -> Corpses -> All
  - Refuse -> Body Parts -> All
  - Refuse -> Hair/Wool -> All


.. figure:: images/stockpile2-4.png

  Clarification: The difference between the two different "Corpses" Settings

4. Foodstuffs
-------------

The Foodstuffs Stockpile should not be a Quantum Stockpile, due to the wonky
way that barrels and empty barrels interact in the basic stockpile settings.
There is a tendency for items and bags to get stuck inside barrels which then
become unmovable for Stockpiling purposes. You should keep your stockpiles,
that use barrels, as regular Large Area Stockpiles, for simplicity's sake.

.. info:: Surprise! Food is a little more complicated, so in addition to the
  fourth primary stockpile, Foodstuffs, we have a few extra secondary
  stockpiles: Plants, Seeds, Booze, and Prepared Meals.

General Foodstuffs Stockpile Settings
"""""""""""""""""""""""""""""""""""""

.. figure:: images/stockpile2-8.gif

  The general Foodstuffs Stockpile is a standard Large Area Stockpile with
  barrels allowed.

Set **maximum barrels**, 0 bins, and 0 wheelbarrows.

- Food -> Meat -> All
- Food -> Fish -> All
- Food -> Unprepared Fish -> All
- Food -> Egg -> All
- Food -> Cheese (Animal) -> All
- Food -> Fruit/Leaves -> All
- Food -> Milled Plants -> Everything **but** the four Dyes
- Food -> Fats (How to do this? Refer to :ref:`Fine Grained Item Selection section <betterstockpiling02select>`)
- Food -> Paste -> All
- Food -> Pressed Material -> All
- Food -> Extract (Plant) -> All Non-Oils
- Food -> Extract (Animal) -> All


Plants Stockpile Settings
"""""""""""""""""""""""""

Plants get their own stockpile, because they can be QSPed.

Create a Light Items QSP  and *disable all barrels, bins, and wheelbarrows.*

- Food -> Plants -> All


This will help with all of the job cancellations generated from plants being inside hauled barrels.

Seeds Stockpile Settings
"""""""""""""""""""""""

Seeds also get their own stockpile all to themselves, but there is no need for
a QSP. *Disable all barrels, bins, and wheelbarrows*

- Food -> Seeds

Booze Stockpile Settings
""""""""""""""""""""""""

You probably want to store your booze close to your meeting hall or
tavern. Booze is stored in barrels, so we do not use a QSP.

Set **maximum barrels**, 0 bins, and 0 wheelbarrows.

- Food -> Drink (Plant)
- Food -> Drink (Animal)

Prepared Meals Stockpile Settings
""""""""""""""""""""""""""""""""

You probably want to store your prepared meals close to your meeting hall or
tavern. Meals are stored in barrels, so we do not use a QSP.

Set **maximum barrels**, 0 bins, and 0 wheelbarrows.

- Food -> Prepared Food :kbd:`u`

You can achieve this by:

- :kbd:`e` enable :guilabel:`Food`
- Press :kbd:`right`, then :kbd:`b` to :guilabel:`Block All`
- Then press `u` to enable food


5. Animals Stockpile Settings

The Animals Stockpile is a collection of 2x3 Heavy Item Stockpiles

- Animals -> All Animals

Make sure :guilabel:`Empty Cages` and :guilabel:`Empty Animal` Traps are *disabeld*.

The use of 2x3 stockpiles with wheelbarrows for hauling animal cages is
preferred because they can be heavy when some enemies are in them.

Suggestions for Creating Custom Stockpiles
===========================================

Acquire the habit of using :kbd:`p`, :kbd:`t` and/or :kbd:`p`, :kbd:`c` when
creating Custom Stockpiles. By doing so, all of your custom settings will only
have to be set once as you place as many copies of that Stockpile as you want.

For each Quantum Stockpile you create, you're going to need to place two
Stockpiles at least: One Receiver and One QSP.

It's easier to set the settings once, and then place two stockpiles, than it is
to place two generic Stockpiles, and then go in to the settings of each
Stockpile and modify them.

From :kbd:`p`, :kbd:`c`, you can also set how many bins and barrels to reserve per
Stockpile. **Always** leave these at 0 unless specifically noted
otherwise. Once you are happy with the reserve numbers, press :kbd:`t` to modify the
content settings.

.. figure:: images/stockpile2-5.gif

  Reserving bins and barrels from the stockpile settings.

If you already have a custom Stockpile created, you can also use the DFHack
plugin copystock to copy the settings of an existing stockpile:

:kbd:`q` uery the stockplie and then press :kbd:`Alt` + :kbd:`p` to copy all of
that stockpile's settings. You can also simply type ``copystock`` in the
DFHack Console, instead of pressing the shortcut. Then place that new stockpile as
normal and it will contain all of your custom settings.

Remember to go back and set your wheelbarrow settings on your Stockpiles
after you've placed them by :kbd:`q` uerying them.

When creating your Hauling Routes, enable everything in the Stop's
Set Desired Items Settings. The items being placed in the Receiver Stockpiles
will be the only things to be placed in the Minecarts anyway, so just go ahead
and enable everything. This will keep you from having to come back in to the
Hauling Screen every time you modify the settings of a Receiver Stockpile. You
can set the desired items once, and not have to worry about it again.


.. _betterstockpiling02select:

Fine Grained Item Selection
===========================

When selecting items from the stockpiles selection screen it can become very
tedious to select certain subsets of items from the list. For example,
we want to store fats in a different stockpile than the tallows, but both of
these are under the same :guilabel:`Fat` category in the stockpile settings.

There are two ways to make selection easy.

The first way is to record and save a macro of yourself selecting the items,
then play it back with you need it. This still requires quite the tedious
upfront cost of recording the macro, but hopefully you only need to do it once.

The second, and preferred way is only available if you have DFHack installed.

Here is the process to select all fats (but not tallows) with this method

a) Move over to the fat and tallow list on the right
b) Press :kbd:`s` to search and type in: ``SPACE fat``. You want to include that empty space before the word fat. Press :kbd:`enter`
c) You'll now see nothing but "fats" listed in the list on the right.
d) Press :kbd:`p` for :guilabel:`Permit Fats`. This will highlight all words in the list on the right with ``SPACE fat`` in its name
e) Press :kbd:`s` to bring up the search feature and press :kbd:`backspace` a few times to clear out the search criteria and then press :kbd:`enter`
f) You will now see :guilabel:`fats` and :guilabel:`tallows` interspersed with each other, but only fats selected

.. figure:: images/stockpile2-1.gif

  Quickly and easily selecting all fats



Return to Part I :ref:`The Five Primary Stockpiles <betterstockpiling01>`

Continue to Part III :ref:`Useful Custom Stockpiles <betterstockpiling03>`
